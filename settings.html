<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Settings - OpsLink</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* --- BASE --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #000, #111, #000);
      color: #fff;
      min-height: 100vh;
    }
    input, button { font-family: inherit; }

    /* --- FLEX LAYOUT --- */
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .flex-1 { flex: 1; }
    .gap-4 { gap: 1rem; }
    .gap-3 { gap: 0.75rem; }

    /* --- SIDEBAR --- */
    aside {
      width: 280px;
      background: rgba(0,0,0,0.5);
      border-right: 1px solid rgba(255,255,255,0.1);
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    aside h2 {
      text-transform: uppercase;
      font-size: 0.75rem;
      color: #aaa;
      margin-bottom: 0.5rem;
      letter-spacing: 1px;
    }
    .tab-btn {
      background: transparent;
      border: none;
      text-align: left;
      padding: 0.5rem 0.75rem;
      color: #ccc;
      border-radius: 6px;
      cursor: pointer;
      margin-bottom: 0.25rem;
      transition: 0.2s;
    }
    .tab-btn:hover { background: rgba(255,255,255,0.08); color: #fff; }
    aside button.logout-btn {
      color: #f87171;
      margin-top: auto;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      text-align: left;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: 0.2s;
    }
    aside button.logout-btn:hover { background: rgba(248,113,113,0.2); }

    /* --- MAIN CONTENT --- */
    main {
      flex: 1;
      padding: 2.5rem;
      overflow-y: auto;
    }
    .tab-content { display: none; max-width: 900px; }
    .tab-content.active { display: block; }

    h1 { font-size: 2rem; font-weight: 700; margin-bottom: 1.5rem; }
    h3 { font-size: 1.125rem; font-weight: 600; margin-bottom: 0.75rem; }

    /* --- CARDS --- */
    .card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    /* --- INPUTS --- */
    .input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(0,0,0,0.4);
      color: #fff;
      outline: none;
      transition: 0.2s;
    }
    .input:focus { border-color: #6366f1; background: rgba(0,0,0,0.6); }

    /* --- BUTTONS --- */
    button {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: 0.2s;
      font-weight: 600;
    }
    .btn-primary { background: #6366f1; color: #fff; }
    .btn-primary:hover { background: #4f46e5; }
    .btn-warning { background: #facc15; color: #000; }
    .btn-warning:hover { background: #eab308; }
    .btn-danger { background: #f87171; color: #fff; }
    .btn-danger:hover { background: #ef4444; }
    .btn-success { background: #22c55e; color: #fff; }
    .btn-success:hover { background: #16a34a; }

    /* --- USER AVATAR --- */
    .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: #6366f1;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 700;
      font-size: 1.5rem;
      margin-right: 1rem;
    }

    /* --- TABLES / LISTS --- */
    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.4);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .list-item p { font-size: 0.875rem; color: #ccc; }
    .list-item button { background: transparent; color: #f87171; font-weight: 600; }

    /* --- DANGER ZONE --- */
    .danger-zone {
      background: rgba(127,29,29,0.2);
      border: 1px solid rgba(248,113,113,0.3);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .text-green { color: #4ade80; }

  </style>
</head>

<body>

<div class="flex min-h-screen">

  <!-- SIDEBAR -->
  <aside>
    <h2>User Settings</h2>
    <button onclick="openTab('account')" class="tab-btn">My Account</button>
    <button onclick="openTab('security')" class="tab-btn">Security</button>
    <button onclick="openTab('sessions')" class="tab-btn">Devices</button>
    <button onclick="openTab('billing')" class="tab-btn">Billing</button>
    <button onclick="openTab('privacy')" class="tab-btn">Privacy</button>

    <button onclick="logout()" class="logout-btn">Log Out</button>
  </aside>

  <!-- MAIN CONTENT -->
  <main>

    <!-- ACCOUNT TAB -->
    <section id="account" class="tab-content active">
      <h1>My Account</h1>
      <div class="card">

        <!-- USER INFO -->
        <div class="flex items-center gap-4 mb-6">
          <div class="avatar" id="avatarLetter">U</div>
          <div>
            <h2 id="discordUsername">Username</h2>
            <p id="discordTag" class="text-zinc-400">@tag</p>
          </div>
        </div>

        <!-- EMAIL & DISCORD -->
        <div class="flex gap-4 mb-6">
          <div style="flex:1">
            <label>Email</label>
            <input id="email" class="input" disabled/>
          </div>
          <div style="flex:1">
            <label>Discord ID</label>
            <input id="discordID" class="input" disabled/>
          </div>
        </div>

        <!-- CHANGE EMAIL -->
        <div class="mb-6">
          <h3>Change Email</h3>
          <div class="flex gap-3 mb-2">
            <input id="newEmail" placeholder="New Email" class="input"/>
            <input id="emailPassword" type="password" placeholder="Current Password" class="input"/>
          </div>
          <button onclick="changeEmail()" class="btn-primary">Update Email</button>
        </div>

        <!-- PASSWORD RESET -->
        <div>
          <h3>Reset Password</h3>
          <p class="text-zinc-400 mb-2">
            Click below to start a secure password reset. An email will be sent to you.
          </p>
          <button onclick="startPasswordReset()" class="btn-warning">Start Reset</button>
          <p id="resetMessage" class="text-green mt-2"></p>
        </div>

      </div>
    </section>

    <!-- SECURITY, DEVICES, BILLING, PRIVACY sections go here ... (same as previous but styled with .card, .list-item, buttons, etc.) -->

  </main>

</div>

<script>
const API = "https://opslinkservers-backend.onrender.com";
const token = localStorage.getItem("token");

if(!token) location.href = "login.html";

function openTab(id){
  document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ================= API HELPER ================= */
async function api(endpoint, data={}, method="POST"){
  const res = await fetch(API + endpoint, {
    method,
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer " + token
    },
    body: method==="GET"?null:JSON.stringify(data)
  });
  return res.json();
}

/* ================= LOAD USER ================= */
async function loadUser(){
  const res = await api("/auth/me", {}, "GET");
  document.getElementById("discordUsername").textContent = res.discordUsername;
  document.getElementById("discordTag").textContent = res.discordTag || "";
  document.getElementById("email").value = res.email;
  document.getElementById("discordID").value = res.discordUserID;
  document.getElementById("avatarLetter").textContent = res.discordUsername[0].toUpperCase();
}
loadUser();

/* ================= ACCOUNT ACTIONS ================= */
async function changeEmail(){
  const res = await api("/auth/change-email", {
    email:document.getElementById("newEmail").value,
    password:document.getElementById("emailPassword").value
  });
  alert(res.message || res.error);
}

async function startPasswordReset(){
  const res = await api("/auth/forgot-password", { email: document.getElementById("email").value });
  document.getElementById("resetMessage").textContent = res.message || "Reset email sent!";
}

/* ================= LOGOUT ================= */
function logout(){
  localStorage.clear();
  location.href="login.html";
}

</script>

</body>
</html>
