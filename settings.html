<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Settings - OpsLink</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-black via-zinc-900 to-black text-white min-h-screen">

<div class="w-full border-b border-white/10 p-4 flex items-center justify-between">
  <h1 class="text-xl font-semibold">Account Settings</h1>
  <button onclick="logout()" class="text-red-400 hover:text-red-300">Logout</button>
</div>

<div class="max-w-6xl mx-auto px-6 py-10 grid gap-8">

<!-- PROFILE -->
<section class="bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-lg font-semibold mb-4">Profile</h2>
  <div class="grid md:grid-cols-2 gap-4">
    <input id="discordUsername" disabled class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
    <input id="discordID" disabled class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
  </div>
</section>

<!-- EMAIL -->
<section class="bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-lg font-semibold mb-4">Change Email</h2>
  <div class="grid md:grid-cols-2 gap-4">
    <input id="newEmail" placeholder="New Email" class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
    <input id="emailPassword" type="password" placeholder="Password" class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
  </div>
  <button onclick="changeEmail()" class="mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded">Update</button>
</section>

<!-- PASSWORD -->
<section class="bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-lg font-semibold mb-4">Change Password</h2>
  <div class="grid md:grid-cols-3 gap-4">
    <input id="currentPassword" type="password" placeholder="Current" class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
    <input id="newPassword" type="password" placeholder="New" class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
    <input id="confirmPassword" type="password" placeholder="Confirm" class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
  </div>
  <button onclick="changePassword()" class="mt-4 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded">Update</button>
</section>

<!-- BILLING -->
<section class="bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-lg font-semibold mb-4">Billing & Payments</h2>

  <div class="grid md:grid-cols-2 gap-6">

    <!-- Card Info -->
    <div class="space-y-3">
      <h3 class="font-semibold">Payment Method</h3>
      <input id="cardName" placeholder="Cardholder Name" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2"/>
      <input id="cardNumber" placeholder="Card Number" maxlength="19" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2"/>
      <div class="grid grid-cols-2 gap-3">
        <input id="cardExp" placeholder="MM/YY" maxlength="5" class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
        <input id="cardCVC" placeholder="CVC" maxlength="4" class="bg-black/40 border border-white/10 rounded px-3 py-2"/>
      </div>
      <button onclick="saveBilling()" class="w-full mt-2 px-4 py-2 bg-green-600 hover:bg-green-700 rounded">
        Save Payment Method
      </button>
    </div>

    <!-- Billing Address -->
    <div class="space-y-3">
      <h3 class="font-semibold">Billing Address</h3>
      <input id="billStreet" placeholder="Street Address" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2"/>
      <input id="billCity" placeholder="City" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2"/>
      <input id="billState" placeholder="Province / State" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2"/>
      <input id="billZip" placeholder="Postal / ZIP Code" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2"/>
      <input id="billCountry" placeholder="Country" class="w-full bg-black/40 border border-white/10 rounded px-3 py-2"/>
    </div>

  </div>
</section>

<!-- PLAN -->
<section class="bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-lg font-semibold mb-4">Subscription Plan</h2>

  <div class="grid md:grid-cols-3 gap-4">
    <div class="bg-black/40 border border-white/10 rounded p-4">
      <h3 class="font-semibold">Free</h3>
      <p class="text-zinc-400 text-sm">Basic features</p>
      <p class="text-xl font-bold mt-2">$0</p>
      <button class="mt-3 w-full px-3 py-2 bg-zinc-700 rounded">Current</button>
    </div>

    <div class="bg-indigo-950/40 border border-indigo-500/20 rounded p-4">
      <h3 class="font-semibold">Pro</h3>
      <p class="text-zinc-400 text-sm">Advanced features</p>
      <p class="text-xl font-bold mt-2">$9.99/mo</p>
      <button onclick="subscribe('pro')" class="mt-3 w-full px-3 py-2 bg-indigo-600 hover:bg-indigo-700 rounded">Upgrade</button>
    </div>

    <div class="bg-yellow-950/40 border border-yellow-500/20 rounded p-4">
      <h3 class="font-semibold">Enterprise</h3>
      <p class="text-zinc-400 text-sm">Unlimited features</p>
      <p class="text-xl font-bold mt-2">$49.99/mo</p>
      <button onclick="subscribe('enterprise')" class="mt-3 w-full px-3 py-2 bg-yellow-600 hover:bg-yellow-700 rounded">Upgrade</button>
    </div>
  </div>
</section>

<!-- BILLING HISTORY -->
<section class="bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-lg font-semibold mb-4">Invoices</h2>
  <div id="invoiceList" class="space-y-2 text-sm text-zinc-300">
    <p>No invoices yet.</p>
  </div>
</section>

<!-- SECURITY -->
<section class="bg-white/5 rounded-xl p-6 border border-white/10">
  <h2 class="text-lg font-semibold mb-4">Security</h2>
  <div class="flex gap-4">
    <button onclick="rotateTokens()" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded">Logout All Sessions</button>
    <button onclick="resetTokenVersion()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded">Force Token Reset</button>
  </div>
</section>

<!-- DANGER -->
<section class="bg-red-950/30 rounded-xl p-6 border border-red-500/20">
  <h2 class="text-lg font-semibold mb-4 text-red-400">Danger Zone</h2>
  <button onclick="deleteAccount()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded">
    Permanently Delete Account
  </button>
</section>

</div>

<script>
const API = "https://opslinkservers-backend.onrender.com";
const token = localStorage.getItem("token");

async function api(endpoint, data={}, method="POST"){
  const res = await fetch(API + endpoint, {
    method,
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer " + token
    },
    body: method === "GET" ? null : JSON.stringify(data)
  });
  return res.json();
}

async function loadUser(){
  const r = await api("/auth/me", {}, "GET");
  discordUsername.value = r.discordUsername;
  discordID.value = r.discordUserID;
}

async function changeEmail(){
  const res = await api("/auth/change-email", { email:newEmail.value, password:emailPassword.value });
  alert(res.message || res.error);
}

async function changePassword(){
  const res = await api("/auth/change-password", { 
    current: currentPassword.value, 
    pass: newPassword.value 
  });
  alert(res.message || res.error);
}

async function saveBilling(){
  const res = await api("/billing/update", {
    card:{
      name:cardName.value,
      number:cardNumber.value,
      exp:cardExp.value,
      cvc:cardCVC.value
    },
    address:{
      street:billStreet.value,
      city:billCity.value,
      state:billState.value,
      zip:billZip.value,
      country:billCountry.value
    }
  });
  alert(res.message || "Billing updated");
}

async function subscribe(plan){
  const res = await api("/billing/subscribe", { plan });
  alert(res.message || "Subscription updated");
}

async function rotateTokens(){
  await api("/auth/rotate-token-version");
  logout();
}

async function resetTokenVersion(){
  await api("/auth/rotate-token-version");
  logout();
}

async function deleteAccount(){
  if(!confirm("This is permanent.")) return;
  await api("/auth/delete");
  logout();
}

function logout(){
  localStorage.clear();
  location.href="/login.html";
}

loadUser();
</script>

</body>
</html>
