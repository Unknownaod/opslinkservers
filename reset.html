<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password - OpsLink</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Success/Fail Animations */
    .feedback {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      border-radius: 8px;
      font-weight: bold;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 50;
    }
    .feedback.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    .feedback.success { background: #22c55e; color: #000; }
    .feedback.fail { background: #ef4444; color: #fff; }
    .feedback svg { width: 24px; height: 24px; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-black via-zinc-900 to-black text-white flex flex-col">

  <!-- Navbar -->
  <nav class="flex items-center justify-between px-10 py-6">
    <div class="flex items-center gap-3 text-xl font-semibold tracking-wide">
      OpsLink Servers
    </div>
    <div class="flex items-center gap-8 text-sm">
      <a href="index.html" class="hover:opacity-80">Home</a>
      <a href="browse.html" class="hover:opacity-80">Browse</a>
      <a href="submit.html" class="hover:opacity-80">Submit</a>
      <a href="login.html" class="rounded-full border border-white px-4 py-2 hover:bg-white/10">Login</a>
      <a href="signup.html" class="rounded-full border border-white px-4 py-2 hover:bg-white/10">Sign Up</a>
    </div>
  </nav>

  <!-- Reset Password Card -->
  <section class="flex-grow flex items-center justify-center px-4">
    <div class="bg-zinc-900/80 border border-zinc-800 p-10 rounded-2xl shadow-2xl max-w-md w-full text-center">
      <img src="https://i.imgur.com/cafgdNU.png" alt="OpsLink Logo" class="w-24 mx-auto mb-6 rounded-full shadow-lg">

      <h1 class="text-3xl font-bold mb-4">Reset Your Password</h1>
      <p class="text-zinc-400 mb-6">Enter your new password below.</p>

      <form id="resetForm" class="flex flex-col gap-4">
        <input type="password" id="newPassword" placeholder="New Password" class="bg-zinc-800 text-white p-2 rounded-lg" required />
        <input type="password" id="confirmPassword" placeholder="Confirm Password" class="bg-zinc-800 text-white p-2 rounded-lg" required />
        <button type="submit" class="bg-green-500 text-black px-5 py-2 rounded-lg font-semibold hover:bg-green-600">Reset Password</button>
      </form>
    </div>
  </section>

  <!-- Feedback Notifications -->
  <div id="feedback" class="feedback">
    <svg id="feedbackIcon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"></svg>
    <span id="feedbackText"></span>
  </div>

  <!-- Footer -->
  <footer class="px-10 py-10 border-t border-zinc-800 text-sm text-zinc-400 flex justify-between">
    <span>© 2026 OpsLink Servers</span>
    <span>Not affiliated with Discord</span>
  </footer>

<script>
const API_URL = 'https://opslinkservers-backend.onrender.com';
const params = new URLSearchParams(window.location.search);
const token = params.get('token');

const feedback = document.getElementById('feedback');
const feedbackIcon = document.getElementById('feedbackIcon');
const feedbackText = document.getElementById('feedbackText');

function showFeedback({ type, message, duration = 2500 }) {
  feedback.className = `feedback show ${type}`;
  feedbackText.textContent = message;

  // Set icon
  if(type === "success") {
    feedbackIcon.innerHTML = `
      <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
    `;
  } else {
    feedbackIcon.innerHTML = `
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
    `;
  }

  // Hide after duration
  setTimeout(() => {
    feedback.className = "feedback";
  }, duration);
}

document.getElementById('resetForm').addEventListener('submit', async e => {
  e.preventDefault();
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;

  if (newPassword !== confirmPassword) {
    showFeedback({ type: 'fail', message: "⚠️ Passwords do not match." });
    return;
  }

  try {
    const res = await fetch(`${API_URL}/api/auth/reset-password`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token, newPassword })
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "Failed to reset password");

    showFeedback({ type: 'success', message: "✅ Password reset successfully! Redirecting..." });
    setTimeout(() => window.location.href = 'login.html', 2500);

  } catch (err) {
    showFeedback({ type: 'fail', message: `❌ ${err.message || "Something went wrong."}` });
  }
});
</script>

</body>
</html>
