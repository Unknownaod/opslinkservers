<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit Server - OpsLink</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-black via-zinc-900 to-black text-white overflow-x-hidden">

  <!-- Navbar -->
  <nav class="flex items-center justify-between px-10 py-6">
    <div class="text-xl font-semibold tracking-wide">OpsLink Servers</div>
    <div class="flex items-center gap-8 text-sm" id="navLinks">
      <a href="index.html" class="hover:opacity-80">Home</a>
      <a href="browse.html" class="hover:opacity-80">Browse</a>
      <a href="submit.html" class="hover:opacity-80">Submit</a>
      <a href="login.html" id="loginBtn" class="rounded-full border border-white px-4 py-2 hover:bg-white/10">Login</a>
    </div>
  </nav>

  <section class="px-10 py-10 max-w-2xl mx-auto">
    <h1 class="text-5xl font-bold mb-6">Submit Your Discord Server</h1>

    <!-- Instructions & Rules -->
    <div class="bg-zinc-800 p-4 rounded text-zinc-300 mb-6">
      <h2 class="font-semibold mb-2">Submission Rules & Responsibilities</h2>
      <ul class="list-disc list-inside text-sm space-y-1">
        <li>You must be the <strong>server owner</strong> or an <strong>authorized representative</strong>.</li>
        <li>All information submitted must be <strong>accurate and truthful</strong>. Any false information will result in immediate denial.</li>
        <li>By submitting, you acknowledge that if your server is approved, <strong>you are fully responsible</strong> for its content, moderation, and community management.</li>
        <li>OpsLink Servers reserves the right to remove your server at any time if it violates our guidelines.</li>
        <li>NSFW content must be properly labeled, or your server will be denied.</li>
      </ul>
    </div>

    <!-- Submission Form -->
    <div class="bg-zinc-900/80 border border-zinc-800 p-6 rounded">
      <form id="submitForm" class="flex flex-col gap-4">
        <!-- Basic Info -->
        <input name="name" placeholder="Server Name" class="p-2 rounded bg-zinc-800" required/>
        <input name="invite" placeholder="Server Invite Link" class="p-2 rounded bg-zinc-800" required/>
        <textarea name="description" placeholder="Brief Description" class="p-2 rounded bg-zinc-800" required></textarea>

        <!-- Advanced Server Info -->
        <input name="language" placeholder="Primary Language (e.g., English)" class="p-2 rounded bg-zinc-800"/>
        <input name="members" type="number" placeholder="Approximate Number of Members" class="p-2 rounded bg-zinc-800"/>
        <select name="type" class="p-2 rounded bg-zinc-800">
          <option value="">Server Type</option>
          <option value="gaming">Gaming</option>
          <option value="community">Community</option>
          <option value="education">Education</option>
          <option value="hobby">Hobby / Interest</option>
          <option value="other">Other</option>
        </select>
        <textarea name="rules" placeholder="Server Rules (Optional)" class="p-2 rounded bg-zinc-800"></textarea>
        <input name="website" placeholder="Website / Social Links (Optional)" class="p-2 rounded bg-zinc-800"/>
        <label class="flex items-center gap-2">
          <input type="checkbox" name="nsfw"/> NSFW
        </label>

        <!-- Acknowledgment -->
        <label class="flex items-center gap-2 text-sm">
          <input type="checkbox" name="acknowledge" required/>
          I confirm I am the server owner or authorized representative and understand all responsibilities listed above.
        </label>

        <button type="submit" class="bg-white text-black px-4 py-2 rounded hover:bg-zinc-200">Submit Server</button>
      </form>
    </div>
  </section>

  <!-- Footer -->
  <footer class="px-10 py-10 border-t border-zinc-800 text-sm text-zinc-400 flex justify-between">
    <span>Â© 2026 OpsLink Servers</span>
    <span>Not affiliated with Discord</span>
  </footer>

<script>
const API_URL = 'https://opslinkservers-backend.onrender.com';
let currentUser = null;

// Check if user is logged in
async function checkUser() {
  try {
    const res = await fetch(`${API_URL}/api/me`, { credentials: 'include' });
    if (!res.ok) throw new Error('Not logged in');
    currentUser = await res.json();

    // Update login button
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.textContent = 'Logout';
    loginBtn.href = '#';
    loginBtn.addEventListener('click', async () => {
      await fetch(`${API_URL}/api/logout`, { method: 'POST', credentials: 'include' });
      window.location.reload();
    });
  } catch(err) {
    console.log('Not logged in', err);
  }
}

// Handle form submission
document.getElementById('submitForm').addEventListener('submit', async e => {
  e.preventDefault();
  if (!currentUser) {
    alert('You must be logged in to submit a server.');
    window.location.href = '/login.html';
    return;
  }

  const data = Object.fromEntries(new FormData(e.target));
  data.tags = data.tags ? data.tags.split(',').map(t => t.trim()) : [];
  data.nsfw = data.nsfw ? true : false;

  if (!data.acknowledge) {
    alert("You must confirm that you are the server owner or authorized representative.");
    return;
  }

  try {
    const res = await fetch(`${API_URL}/api/servers`, {
      method: 'POST',
      credentials: 'include', // use cookie for auth
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    if (res.ok) {
      alert('Server submitted! Awaiting approval.');
      e.target.reset();
    } else {
      const err = await res.json();
      alert('Submission failed: ' + (err.error || err.message));
    }
  } catch (err) {
    alert('Submission failed. Please try again later.');
    console.error(err);
  }
});

checkUser();
</script>

</body>
</html>
